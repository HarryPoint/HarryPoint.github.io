<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Hi Harry RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Hi Harry Atom Feed"><title data-react-helmet="true">nodejs从零部署 | Hi Harry</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://harrypoint.github.io/docs/nodejs从零部署"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="nodejs从零部署 | Hi Harry"><meta data-react-helmet="true" name="description" content="基础命令（基于 ubuntu）"><meta data-react-helmet="true" property="og:description" content="基础命令（基于 ubuntu）"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://harrypoint.github.io/docs/nodejs从零部署"><link data-react-helmet="true" rel="alternate" href="https://harrypoint.github.io/docs/nodejs从零部署" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://harrypoint.github.io/docs/nodejs从零部署" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.56ac51d8.css">
<link rel="preload" href="/assets/js/runtime~main.4e745f3e.js" as="script">
<link rel="preload" href="/assets/js/main.a842c4ef.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo.png" alt="Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Hi Harry</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/notes">随笔</a><a class="navbar__item navbar__link" href="/blog">博客</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/HarryPoint" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_I7kZ"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_Zg7X searchBarLoadingRing_J5Ez"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_CDc6"><kbd class="searchHint_2RRg">ctrl</kbd><kbd class="searchHint_2RRg">K</kbd></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/js动画库">js动画库</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/notes">资源列表</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Array方法速记表">Array方法速记表</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Object方法速记表">Object方法速记表</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/React笔记">React笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Reflect速记表">Reflect速记表</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/TypeScript教程">TypeScript教程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/WebAssembly">WebAssembly</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/css动画库">css动画库</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docker命令图解">docker命令图解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docker镜像和容器的保存">docker镜像和容器的保存</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/gitlab-runner配置">gitlab-runner配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/git常用命令">git常用命令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/git常用命令2">git常用命令2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/jenkins插件与部署">jenkins插件与部署</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/jenkins部署配置">jenkins部署配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/js递归优化">js递归优化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/linux docker环境安装">linux docker环境安装</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/linux expect命令行交互自动执行">linux expect命令行交互自动执行</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/linux命令行快捷键">linux命令行快捷键</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/linux安装前端环境">linux安装前端环境</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/linux常用命令">linux常用命令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/nodejs从零部署">nodejs从零部署</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/npm包记录">npm包记录</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/offer准备工作">准备工作</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/postcss插件">postcss插件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/react+typescript">react+typescript</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/v8原理">v8原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/webpack原理">webpack原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/weinre调试工具">weinre调试工具</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/yarn命令">yarn命令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/你真的了解正则吗？">你真的了解正则吗？</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/初始化server环境">node</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/制作docker镜像">制作docker镜像</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/前端图形学">前端图形学</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/图片主色提取">图片主色提取</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/奇怪的javascrpt">老司机写js</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/学习资源汇总">学习资源汇总</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/常用小游戏框架">常见游戏框架</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/数据结构与算法">数据结构与算法</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/相等判断">前置知识</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/综合笔记">综合笔记</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>nodejs从零部署</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="基础命令基于-ubuntu">基础命令（基于 ubuntu）<a class="hash-link" href="#基础命令基于-ubuntu" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">fdisk</span><span class="token plain"> -l </span><span class="token comment" style="color:#999988;font-style:italic"># 查看挂载的硬盘</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">df</span><span class="token plain"> -h </span><span class="token comment" style="color:#999988;font-style:italic"># 查看硬盘使用情况</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="linux-账户操作">linux 账户操作<a class="hash-link" href="#linux-账户操作" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1添加用户名">1.添加用户名<a class="hash-link" href="#1添加用户名" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">adduser </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">username</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2给账户-sudo-权限">2.给账户 sudo 权限<a class="hash-link" href="#2给账户-sudo-权限" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">gpasswd -a </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">username</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="3权限配置修改">3.权限配置修改<a class="hash-link" href="#3权限配置修改" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> visudo</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><blockquote><p>1.在 <code># User privilege specification</code> 下添加一行 <code>{username} ALL=(ALL:ALL) ALL</code><br> 2.<code>^+X</code>退出编辑，<code>Shift+Y</code>保存，·<code>enter</code>回车 回到命令行<br> 3.<code>service ssh restart</code> 重启服务</p></blockquote><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ssh-免密登录"><code>ssh</code> 免密登录<a class="hash-link" href="#ssh-免密登录" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="在本地操作">在本地操作<a class="hash-link" href="#在本地操作" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="1生成密钥">1.生成密钥<a class="hash-link" href="#1生成密钥" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen -t res -b </span><span class="token number" style="color:#36acaa">4096</span><span class="token plain"> -C </span><span class="token string" style="color:#e3116c">&quot;xxx@xxx.com&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="2-开启ssh-agent服务">2. 开启<code>ssh-agent</code>服务<a class="hash-link" href="#2-开启ssh-agent服务" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">eval</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable" style="color:#36acaa">ssh-agent -s</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="3-添加密钥">3. 添加密钥<a class="hash-link" href="#3-添加密钥" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">ssh-add ~/.ssh/id_rsa</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="服务器端操作">服务器端操作<a class="hash-link" href="#服务器端操作" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="1-和本地操作一致生成密钥开启ssh-agent服务">1. 和本地操作一致，生成密钥，开启<code>ssh-agent</code>服务<a class="hash-link" href="#1-和本地操作一致生成密钥开启ssh-agent服务" title="Direct link to heading">​</a></h4><h4 class="anchor anchorWithStickyNavbar_y2LR" id="2-生成authorized_keys文件">2. 生成<code>authorized_keys</code>文件<a class="hash-link" href="#2-生成authorized_keys文件" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">vi</span><span class="token plain"> ~/.ssh/authorized_keys</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="3-将本地-id_rsapub-里面的内容-复制到服务端的-authorized_keys文件中">3. 将本地 <code>id_rsa.pub</code> 里面的内容 复制到服务端的 <code>authorized_keys</code>文件中<a class="hash-link" href="#3-将本地-id_rsapub-里面的内容-复制到服务端的-authorized_keys文件中" title="Direct link to heading">​</a></h4><h4 class="anchor anchorWithStickyNavbar_y2LR" id="4-改变authorized_keys文件权限">4. 改变<code>authorized_keys</code>文件权限<a class="hash-link" href="#4-改变authorized_keys文件权限" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">600</span><span class="token plain"> ~/.ssh/authorized_keys</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="5-重启-ssh-服务">5. 重启 ssh 服务<a class="hash-link" href="#5-重启-ssh-服务" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> restart</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="修改-ssh-默认端口">修改 ssh 默认端口<a class="hash-link" href="#修改-ssh-默认端口" title="Direct link to heading">​</a></h2><blockquote><p>tips: 修改前 先新开命令行窗口，登录到服务器（防止修改出问题，导致登录不上服务器）<br></p></blockquote><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">vi</span><span class="token plain"> /etc/ssh/sshd_config</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol><li>修改 <code>Port</code> 参数，修改为新的端口</li></ol><blockquote><p>注意：<code>1~1024</code>端口为系统备用，且需要 root 权限才能启动，所以选择 <code>1025~65536</code>之间的端口</p></blockquote><ol start="2"><li><code>UseDNS</code>确保为<code>no</code>，文件最后添加一行<code>AllowUsers {username}</code></li><li>保存退出</li><li>重启 ssh 服务<code>sudo service ssh restart</code></li><li>重新登录服务器<code>ssh -p {port} {username}@{server ip}</code></li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="关闭-root-用户-ssh-登录">关闭 root 用户 ssh 登录<a class="hash-link" href="#关闭-root-用户-ssh-登录" title="Direct link to heading">​</a></h2><ol><li>打开 ssh 配置文件<code>sudo vi /etc/ssh/sshd_config</code></li><li>修改<code>PermitRootLogin</code>为<code>no</code></li><li>退出编辑并保存</li><li>重启 ssh 服务<code>sudo service ssh restart</code></li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="开启-iptables">开启 iptables<a class="hash-link" href="#开启-iptables" title="Direct link to heading">​</a></h2><ol><li>清空配置<code>sudo iptables -F</code></li><li>编辑配置文件<code>sudo vi /etc/iptables.up.rules</code></li></ol><div class="codeBlockContainer_J+bg language-txt theme-code-block"><div class="codeBlockContent_csEI txt"><pre tabindex="0" class="prism-code language-txt codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">*filter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 允许连接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 允许出口流量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A OUTPUT -j ACCEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 允许443端口访问（https）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A INPUT -p tcp --dport 443 -j ACCEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 允许80端口访问（http）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A INPUT -p tcp --dport 80 -j ACCEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 允许39999 ssh登录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A INPUT -p tcp -m state --state NEW --dport 39999 -j ACCEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 允许ping服务器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A INPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 允许mongoDB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A INPUT -s 127.0.0.1 -p tcp --destination-port 27017 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A OUTPUT -d 127.0.0.1 -p tcp --source-port 27017 -m state --state ESTABLISHED -j ACCEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 记录被拒绝登录的信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A INPUT -m limit --limit 5/min -j LOG --log-prefix &quot;iptables denied:&quot; --log-level 7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 拦截敏感请求（60秒内发出150个请求）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A INPUT -p tcp --dport 80 -i eth0 -m state --state NEW -m recent --set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A INPUT -p tcp --dport 80 -i eth0 -m state --state NEW -m recent --update --seconds 60 --hitcount 150 -j DROP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 拒绝其他请求</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A INPUT -j REJECT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A FORWARD -j REJECT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COMMIT</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="3"><li>启用配置文件<code>sudo iptables-restore &lt; /etc/iptables.up.rules</code></li><li>查看防火墙状态<code>sudo ufw status</code>,如果显示 <code>inactive</code>则为未激活</li><li>激活防火墙<code>sudo ufw enable</code></li><li>开启重启自动激活功能<code>sudo vi /etc/network/if-up.d/iptables</code>, 写入内容</li></ol><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables-restore /etc/iptables.up.rules</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="7"><li>写入执行权限<code>sudo chmod +x /etc/network/if-up.d/iptables</code></li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="生产环境搭建">生产环境搭建<a class="hash-link" href="#生产环境搭建" title="Direct link to heading">​</a></h2><p>1.基础包安装</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> openssl build-essential libssl-dev </span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">git</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>2.安装 nvm 3.安装 nodejs</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">nvm </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> v6.9.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nvm use v6.9.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nvm </span><span class="token builtin class-name">alias</span><span class="token plain"> default v6.9.5 </span><span class="token comment" style="color:#999988;font-style:italic"># 设为默认</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node -v</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>4.设置系统文件监控数量<code>echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf &amp;&amp; sudo sysctl -p</code></p><p>5.配置 nginx</p><blockquote><p>/etc/nginx/conf.d/xxx.conf</p></blockquote><div class="codeBlockContainer_J+bg language-txt theme-code-block"><div class="codeBlockContent_csEI txt"><pre tabindex="0" class="prism-code language-txt codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">upstream demo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 127.0.0.1:8081;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen 80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name xxx.xxx.xx(ip地址);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Forward-For $proxy_add_x_forwarded_for;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Host $http_host;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Nginx-Proxy true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_pass http://demo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_redirect off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 静态文件配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location ~* ^.+\.(jpg|jpeg|gif|png|ico|css|js|pdf|txt) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        root /www/demo/current/public;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><blockquote><p>tips: 隐藏 nginx 版本信息<code>sudo /etc/nginx/nginx.conf</code>将 <code># server_tokens off;</code>的注释取消掉</p></blockquote><h2 class="anchor anchorWithStickyNavbar_y2LR" id="mongodb-使用">mongoDB 使用<a class="hash-link" href="#mongodb-使用" title="Direct link to heading">​</a></h2><ol><li>开启服务 <code>sudo service mongod start</code></li><li>查看日志 <code>cat /var/log/mongodb/mongod.log</code></li><li>修改 iptables 配置</li></ol><div class="codeBlockContainer_J+bg language-txt theme-code-block"><div class="codeBlockContent_csEI txt"><pre tabindex="0" class="prism-code language-txt codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain"># 允许mongoDB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A INPUT -s 127.0.0.1 -p tcp --destination-port 27017 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A OUTPUT -d 127.0.0.1 -p tcp --source-port 27017 -m state --state ESTABLISHED -j ACCEPT</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="4"><li>启用配置文件<code>sudo iptables-restore &lt; /etc/iptables.up.rules</code></li><li>连接 mongoDB 实例<code>mongo</code></li><li>mongoDB 服务命令：
(1).开启服务<code>sudo service mongod start</code>
(2).停止服务<code>sudo service mongod stop</code>
(3).重启服务<code>sudo service mongod restart</code></li><li>更改 mongoDB 端口<code>sudo vi /etc/mongod.conf</code>修改<code>port</code>参数，重启服务。修改 iptables 配置，重新载入配置。连接 mongoDB <code>mongo --port {端口}</code></li><li>备份本地 mongoDB 数据<code>mongodump -h 127.0.0.1:27017 -d {数据库名称} -o {文件夹名称}</code></li><li>压缩备份文件<code>tar zcvf {filename}.tar.gz {file-roder-name}</code></li><li>scp 上传</li><li>服务器端解压缩<code>tar xvf {filename}.tar.gz</code></li><li>导入数据<code>mongorestore --host 127.0.0.1:27017 -d {数据库名} {数据路径}</code></li><li>本地导出单表数据<code>mongoexport -d {数据库名} -c {表名称} -o {存放路径： ./xx.json}</code></li><li>导入单表数据<code>mongoimport --host 127.0.0.1:27017 -d {数据库名} -c {表名称} {数据路径}</code></li><li>删除数据库<code>mongo --host 127.0.0.1:27017 {数据库名} --eval &quot;db.dropDatabase()&quot;</code></li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="mongodb-权限设置">mongoDB 权限设置<a class="hash-link" href="#mongodb-权限设置" title="Direct link to heading">​</a></h2><ol><li>账户设置</li></ol><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">mongo </span><span class="token comment" style="color:#999988;font-style:italic"># 进入mongoDB实例</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use admin </span><span class="token comment" style="color:#999988;font-style:italic"># 切换到`admin`数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.createUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">user: </span><span class="token string" style="color:#e3116c">&#x27;demo&#x27;</span><span class="token plain">, pwd: </span><span class="token string" style="color:#e3116c">&#x27;xxx1234&#x27;</span><span class="token plain">, roles: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">role: </span><span class="token string" style="color:#e3116c">&#x27;userAdminAnyDatabase&#x27;</span><span class="token plain">, db: </span><span class="token string" style="color:#e3116c">&#x27;admin&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 创建管理员账户</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.auth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;demo&#x27;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&#x27;xxx1234&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 登录授权（返回1 则授权成功）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">数据库名称</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 切换数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.createUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">user: </span><span class="token string" style="color:#e3116c">&#x27;username1&#x27;</span><span class="token plain">, pwd: </span><span class="token string" style="color:#e3116c">&#x27;xxx222&#x27;</span><span class="token plain">, roles: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">role: </span><span class="token string" style="color:#e3116c">&#x27;readWrite&#x27;</span><span class="token plain">, db: </span><span class="token string" style="color:#e3116c">&#x27;数据库名称&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 创建读写权限账户</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.createUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">user: </span><span class="token string" style="color:#e3116c">&#x27;username2&#x27;</span><span class="token plain">, pwd: </span><span class="token string" style="color:#e3116c">&#x27;xxx222&#x27;</span><span class="token plain">, roles: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">role: </span><span class="token string" style="color:#e3116c">&#x27;read&#x27;</span><span class="token plain">, db: </span><span class="token string" style="color:#e3116c">&#x27;数据库名称&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 创建读权限用户（用于数据备份）</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="2"><li>开启认证模式</li></ol><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">vi</span><span class="token plain"> /etc/mongod.conf</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>开启 <code>security</code>:</p><div class="codeBlockContainer_J+bg language-text theme-code-block"><div class="codeBlockContent_csEI text"><pre tabindex="0" class="prism-code language-text codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">security:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  authorization: &#x27;enabled&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>重启服务</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"> mongod restart</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>进入数据库</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">mongo </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:27017/</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">数据库名称</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> -u </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">用户名</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> -p </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">密码</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show tables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.user.find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="mongodb-数据备份">mongoDB 数据备份<a class="hash-link" href="#mongodb-数据备份" title="Direct link to heading">​</a></h2><ol><li>新建备份脚本</li></ol><div class="codeBlockContainer_J+bg language-sh theme-code-block"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">backUpFolder = /home/backUp/db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">date_now = `date +%Y_%m_%d_%H%M`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">backFileName = app_$date_now</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd $backUpFolder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p $backFileName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongodump -h 127.0.0.1:27017 -d {数据库名称} -u {账户名称} -p {密码} -o $backFileName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar zcvf $backFileName.tar.gz $backFileName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf $backFileName</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>2.利用<code>crontab</code>开启自动备份</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">crontab</span><span class="token plain"> -e</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>编辑内容</p><div class="codeBlockContainer_J+bg language-txt theme-code-block"><div class="codeBlockContent_csEI txt"><pre tabindex="0" class="prism-code language-txt codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">13 00 * * * sh {脚本路径}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ssl-证书">ssl 证书<a class="hash-link" href="#ssl-证书" title="Direct link to heading">​</a></h2><ol><li><p>免费证书</p><blockquote><p><a href="https://www.upyun.com/products/ssl" target="_blank" rel="noopener noreferrer">又拍云</a><br>
<a href="https://www.qiniu.com/" target="_blank" rel="noopener noreferrer">七牛云</a><br>
<a href="https://cloud.tencent.com/" target="_blank" rel="noopener noreferrer">腾讯云</a></p></blockquote></li><li><p>nginx 重定向配置</p></li></ol><div class="codeBlockContainer_J+bg language-txt theme-code-block"><div class="codeBlockContent_csEI txt"><pre tabindex="0" class="prism-code language-txt codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen 80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name xxxx.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # rewrite ^(.*) https://$host$1 permanent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 301 https://xxxx.com$request_uri;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><blockquote><p><a href="https://cloud.tencent.com/document/product/400/47360" target="_blank" rel="noopener noreferrer">安装教程</a></p></blockquote></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/HarryPoint/HarryPoint.github.io/blob/main/docs/nodejs从零部署.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/linux常用命令"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">linux常用命令</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/npm包记录"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">npm包记录</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#基础命令基于-ubuntu" class="table-of-contents__link toc-highlight">基础命令（基于 ubuntu）</a></li><li><a href="#linux-账户操作" class="table-of-contents__link toc-highlight">linux 账户操作</a><ul><li><a href="#1添加用户名" class="table-of-contents__link toc-highlight">1.添加用户名</a></li><li><a href="#2给账户-sudo-权限" class="table-of-contents__link toc-highlight">2.给账户 sudo 权限</a></li><li><a href="#3权限配置修改" class="table-of-contents__link toc-highlight">3.权限配置修改</a></li></ul></li><li><a href="#ssh-免密登录" class="table-of-contents__link toc-highlight"><code>ssh</code> 免密登录</a><ul><li><a href="#在本地操作" class="table-of-contents__link toc-highlight">在本地操作</a></li><li><a href="#服务器端操作" class="table-of-contents__link toc-highlight">服务器端操作</a></li></ul></li><li><a href="#修改-ssh-默认端口" class="table-of-contents__link toc-highlight">修改 ssh 默认端口</a></li><li><a href="#关闭-root-用户-ssh-登录" class="table-of-contents__link toc-highlight">关闭 root 用户 ssh 登录</a></li><li><a href="#开启-iptables" class="table-of-contents__link toc-highlight">开启 iptables</a></li><li><a href="#生产环境搭建" class="table-of-contents__link toc-highlight">生产环境搭建</a></li><li><a href="#mongodb-使用" class="table-of-contents__link toc-highlight">mongoDB 使用</a></li><li><a href="#mongodb-权限设置" class="table-of-contents__link toc-highlight">mongoDB 权限设置</a></li><li><a href="#mongodb-数据备份" class="table-of-contents__link toc-highlight">mongoDB 数据备份</a></li><li><a href="#ssl-证书" class="table-of-contents__link toc-highlight">ssl 证书</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/notes">随笔</a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/HarryPoint" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 , Inc. Built by Harry.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.4e745f3e.js"></script>
<script src="/assets/js/main.a842c4ef.js"></script>
</body>
</html>